---
title: "The Effect of Covid on Different Industries (STAT400)"
author: "Sean Markey (116035729), "
output:
  html_document:
    number_sections: yes
    toc: yes  
  pdf_document:
    toc: yes
---
# Simple COVID Data Exploration

This notebook is intended to be a simple notebook that utilizes the COVID 19 dataset. Hopefully this notebook helps clarify some of the code in this notebook with comments and latex/markdown cells. 

```{r message=TRUE, warning=TRUE, include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyverse)
library(janitor)
library(gganimate)
library(gifski)
library(png)
library(ggrepel)
library(scales)
library(gapminder)
# library(shinyWidgets)
library(data.table)
```

## Reading The Data

To read the data we need to provide the paths to the csv files that we will use. Specifically, we want:

* US Confirmed Cases Over Time - time_series_covid19_confirmed_US.csv

The paths below are relative; the "./" translates to current directory so if you are running this code you would want your file structure to look like this

* parent_dir
  * final_proj.rmd
  * data Directory
    * time_series_covid19_confirmed_US.csv
    
```{r}
path_US_confirmed <- "./data/time_series_covid19_confirmed_US.csv"

cases <- read.csv(path_US_confirmed)
head(cases)
```
### Filter Columns
Let's first filter the data to only include the relevant columns. The select command allows us to filter on select columns. Let's make a simplifying assumption that we are only concerned with data per state over time. For this we would need only the Province_State column and columns that start with the letter X (for dates).

```{R}
cases = cases %>% select("Province_State" | starts_with("X"))
head(cases)

```

### Group By State

Now that we have dropped all unnecessary features, the next issue is that we have multiple rows for each state. It makes sense that we should group these rows together based on Province_State and sum the values in each cell.

The group_by function groups a dataframe by a specific variable (in our case Province_State) and the summarize function aggregates all columns starting with an X.

```{r}
cases = cases %>% group_by(Province_State) %>% summarise(across(starts_with("X"), sum))
head(cases) #uncomment to see dataframe in RStudio

```

### Melt Columns

The next step is to melt the columns for date. A good dataset shouldn't have a column for each date. It makes more sense for us to have a row for each state and date combination. The process of taking multiple columns and converting it into two columns (one for the column name and the other for the value) is called melting. 

Let's do this with the data that we have by using the melt command from the data.table library. The id is the variable we intend to keep (Province State), measure is the columns we want to melt (anything that starts with X), value is the name of the data in the table (Cases/Deaths) and variable is the name of what the column headers represent (Dates).

```{r}
case_delta <- cases

for(i in 2:ncol(cases)) {       # for-loop over columns
  
  if(i > 3) {
    
    case_delta[ , i] = abs((cases[ , i] - cases[ , i-1]))
    
  }
}

head(case_delta)

```

```{r}
case_delta <- colSums(case_delta[,-1])

cases_vec <- as.numeric(case_delta)
cases_vec[1:100]
```

```{r}
dates = names(case_delta)
dates = as.Date(dates, format="X%m.%d.%y")

head(dates)
```

```{r}
plot(dates, cases_vec, xlab="Time", ylab="Daily Confirmed Cases")
title("Daily Confirmed Covid Cases from 2020 to 2022")
```

Now that we have our Covid cases over time correctly charted, we must get some stock data to compare such that we can draw comparisons between daily cases and the values of certain stocks. 

## Reading The Data

To read the data we need to provide the paths to the csv files that we will use. Specifically, we want:

* Johnson & Johnson Stock Prices - historical_JNJ.csv
* Moderna Stock Prices - historical_MRNA.csv
* Pfizer Stock Prices - historical_PFE.csv
* Energy Select Sector Stock Prices - historical_XLE.csv
* Technology Select Sector Stock Prices - historical_XLK.csv
* Consumer Product Select Sector Stock Prices - historical_XLP.csv
* Health Care Select Sector Stock Prices - historical_XLK.csv

The paths below are relative; the "./" translates to current directory so if you are running this code you would want your file structure to look like this

* parent_dir
  * final_proj.rmd
  * data Directory
    * historical_JNJ.csv
    * historical_MRNA.csv
    * historical_PFE.csv
    * historical_XLE.csv
    * historical_XLK.csv
    * historical_XLP.csv
    * historical_XLV.csv
    
```{r}
path_jnj <- "./data/historical_JNJ.csv"
path_moderna <- "./data/historical_MRNA.csv"
path_pfizer <- "./data/historical_PFE.csv"
path_energy <- "./data/historical_XLE.csv"
path_tech <- "./data/historical_XLK.csv"
path_consumer <- "./data/historical_XLP.csv"
path_health <- "./data/historical_XLV.csv"

jnj <- read.csv(path_jnj)
moderna <- read.csv(path_moderna)
pfizer <- read.csv(path_pfizer)
energy <- read.csv(path_energy)
tech <- read.csv(path_tech)
consumer <- read.csv(path_consumer)
health <- read.csv(path_health)

head(health)
```

```{r}
jnj = jnj %>% select("Date" | "Open")
jnj$Open <- parse_number(jnj$Open)

moderna = moderna %>% select("Date" | "Open")
moderna$Open <- parse_number(moderna$Open)

pfizer = pfizer %>% select("Date" | "Open")
pfizer$Open <- parse_number(pfizer$Open)

energy = energy %>% select("Date" | "Open")
tech = tech %>% select("Date" | "Open")
consumer = consumer %>% select("Date" | "Open")
health = health %>% select("Date" | "Open")

health
```
```{r}
jnj$Date <- as.Date(jnj$Date, format="%m/%d/%Y")
moderna$Date <- as.Date(moderna$Date, format="%m/%d/%Y")
pfizer$Date <- as.Date(pfizer$Date, format="%m/%d/%Y")
energy$Date <- as.Date(energy$Date, format="%m/%d/%Y")
tech$Date <- as.Date(tech$Date, format="%m/%d/%Y")
consumer$Date <- as.Date(consumer$Date, format="%m/%d/%Y")
health$Date <- as.Date(health$Date, format="%m/%d/%Y")

health
```


```{r}
jnj = jnj %>% filter(jnj$Date %in% dates)
moderna = moderna %>% filter(moderna$Date %in% dates)
pfizer = pfizer %>% filter(pfizer$Date %in% dates)
energy = energy %>% filter(energy$Date %in% dates)
tech = tech %>% filter(tech$Date %in% dates)
consumer = consumer %>% filter(consumer$Date %in% dates)
health = health %>% filter(health$Date %in% dates)

health
```

```{r}
plot(dates, cases_vec, xlab="Time", ylab="Daily Confirmed Cases", pch=16)
par(new=T)
plot(pfizer$Date, pfizer$Open, type='l', col='red3', axes=F, xlab=NA, ylab=NA)
par(new=T)
plot(jnj$Date, jnj$Open, type='l', col='green1', axes=F, xlab=NA, ylab=NA)
axis(side=4)
```

